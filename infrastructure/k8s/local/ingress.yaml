# Ingress for local routing with nginx-ingress controller
# Provides single entry point for all services
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: brave-forms-ingress
  namespace: brave-forms
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-headers: "DNT,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
spec:
  ingressClassName: nginx
  rules:
  - host: brave-forms.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: web
            port:
              number: 3000
      - path: /graphql
        pathType: Prefix
        backend:
          service:
            name: backend
            port:
              number: 4000
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: backend
            port:
              number: 4000
  - host: minio.brave-forms.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: minio-console
            port:
              number: 9001
---
# Alternative simple ingress without nginx (for Docker Desktop)
apiVersion: v1
kind: Service
metadata:
  name: brave-forms-nodeports
  namespace: brave-forms
  annotations:
    description: "Direct NodePort access for local development"
spec:
  type: ExternalName
  externalName: localhost
  ports:
  - name: backend
    port: 30001
    targetPort: 30001
  - name: web
    port: 30002
    targetPort: 30002
  - name: minio
    port: 30003
    targetPort: 30003